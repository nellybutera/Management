// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
  url  	    = env("DATABASE_URL")
  // uncomment next line if you use Prisma <5.10
  directUrl = env("DATABASE_URL_UNPOOLED")
}


enum Role {
  CUSTOMER
  ADMIN
}

// user model
model User {
  id                Int       @id @default(autoincrement())
  accountNumber     String    @unique // Unique identifier for banking/transactions
  firstName         String
  middleName        String?   // Optional field for middle name
  lastName          String
  dateOfBirth       DateTime  // Required for KYC/compliance (DOB)
  phoneNumber       String?   @unique // For MFA and contact
  
  // authentication & Status Fields
  email             String    @unique
  password          String    // Hashed password
  role              Role      @default(CUSTOMER) // Uses the Role Enum
  refreshTokenHash  String?   // For persistent sessions
  
  // financial/Credit Status Fields
  balance           Float     @default(0)
  creditScore       Int       @default(700) // Initialized for risk assessment

  // Audit and Relationship Fields
  createdAt         DateTime  @default(now())
  
  // Add relationships to other models here (e.g., Transactions, Loans)
  transactions      Transaction[]
  loans             Loan[]
}

// financial models

enum TransactionType {
  DEPOSIT
  WITHDRAWAL
  LOAN_DISBURSEMENT
  LOAN_REPAYMENT
}

model Transaction {
  id                Int               @id @default(autoincrement())
  userId            Int
  amount            Float
  type              TransactionType   // e.g., DEPOSIT, WITHDRAWAL
  description       String?           // Purpose of the transaction
  externalRefId     String?           // For tracing external bank/payment IDs
  createdAt         DateTime          @default(now())
  
  user              User              @relation(fields: [userId], references: [id])
}

// loan model for credit operations:
enum LoanStatus {
  PENDING     // Request submitted, awaiting review
  APPROVED    // Loan accepted, funds ready for disbursement
  REJECTED    // Loan denied
  ACTIVE      // Loan funds disbursed, payments due
  PAID_OFF    // Loan fully repaid
}

model Loan {
  id                Int           @id @default(autoincrement())
  userId            Int
  amountRequested   Float
  termMonths        Int           // Duration of the loan
  purpose           String        // Why the loan is needed
  status            LoanStatus    @default(PENDING)
  createdAt         DateTime      @default(now())
  user              User          @relation(fields: [userId], references: [id])
}